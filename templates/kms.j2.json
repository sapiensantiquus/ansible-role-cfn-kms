{
  "AWSTemplateFormatVersion" : "2010-09-09",
  "Parameters":{
    "KMSKeyDescription":{
      "Type": "String"
    },
    "KMSKeyAutoRotation":{
      "Type": "String",
      "AllowedValues": [
        "true",
        "false"
      ]
    },
    "KMSKeyEnabled":{
      "Type": "String",
      "AllowedValues": [
        "true",
        "false"
      ]
    }
  },
  "Resources" : {
    "{{ kms_key_resource_name }}": {
      "Type" : "AWS::KMS::Key",
      "Properties" : {
        "Description" : { "Ref" : "KMSKeyDescription" },
        "Enabled" : { "Ref" : "KMSKeyEnabled" },
        "EnableKeyRotation" : { "Ref": "KMSKeyAutoRotation" }
{% if kms_key_policy is defined %}
        ,
        "KeyPolicy" : {{ kms_key_policy | to_json }}
{% endif %}
      }
    }
  },
  "Outputs": {
    "KMSKeyARN" : {
      "Value": {
        "Fn::GetAtt": [ "{{ kms_key_resource_name }}", "Arn"]
      }
    },
    "KMSKeyId" : {
      "Value": {
        "Ref": "{{ kms_key_resource_name }}" 
      }
    }
  }
}
